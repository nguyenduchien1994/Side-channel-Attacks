

"""
This scripts fix package sizes for yandex.com suggestions

USAGE:

 mitmdump -s 'fixpackages.py (yandex\.com/suggest-images|yandex\.com/suggest-spok)'    
  Any other one can be added using '|' 
   Sadullah Canakci 
   Boston University 
   ECE Department
"""
import sys
import argparse
from mitmproxy import flowfilter
#from mitmproxy.flow import decoded

class Filter:
    def __init__(self, filter_):
        self.filter = flowfilter.parse(filter_)
    def response(self, flow):
        content_new=''
        #sys.stdout.write("Hello")
        f=open('sadu123.txt','a')
        if flowfilter.match(self.filter, flow):
            flow.intercept()
            content_old = (flow.response.content).decode()
            content_new = content_old + (2000-len(content_old))*' '
            flow.response.content = flow.response.content.replace(content_old.encode(), content_new.encode())
            flow.resume()
            f.write(str(flow))#print("Flow matches filter:")
        f.close()
def start():
    if len(sys.argv) != 2:
        raise ValueError("Usage: -s 'filt.py FILTER'")
    return Filter(sys.argv[1])
                                